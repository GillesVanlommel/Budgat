<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuickBudget</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-slate-50 text-slate-900 font-sans">

  <div class="max-w-md mx-auto p-6">
    <header class="flex justify-between items-center mb-8">
      <h1 class="text-2xl font-bold text-indigo-600">QuickBudget</h1>
      <button id="logoutBtn" class="hidden text-sm text-red-500 underline">Logout</button>
    </header>

    <div id="authSection" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
      <h2 class="text-lg font-semibold mb-4">Login or Sign Up</h2>
      <input type="email" id="email" placeholder="Email" class="w-full p-2 mb-3 border rounded-lg">
      <input type="password" id="password" placeholder="Password" class="w-full p-2 mb-4 border rounded-lg">
      
      <button id="loginBtn" class="w-full bg-indigo-600 text-white py-2 rounded-lg mb-2 hover:bg-indigo-700">Login</button>
      <button id="signupBtn" class="w-full border border-indigo-600 text-indigo-600 py-2 rounded-lg hover:bg-indigo-50">Sign Up</button>
    </div>

    <div id="appSection" class="hidden space-y-6">
      
      <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-6">
        <h2 class="text-lg font-semibold mb-4 text-slate-700">Manage Categories</h2>
        <div class="flex gap-2 mb-4">
          <input type="text" id="newCategoryName" placeholder="New Category (e.g. Rent)"
            class="flex-1 p-2 border rounded-lg">
          <button onclick="addCategory()"
            class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">+</button>
        </div>
        <div id="categoryBadgeList" class="flex flex-wrap gap-2">
        </div>
      </div>

      <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h2 class="text-lg font-semibold mb-4 text-slate-700">Add Transaction</h2>
        <div class="space-y-3">
          <input type="number" id="amount" placeholder="Amount (â‚¬)" class="w-full p-2 border rounded-lg">
          <select id="categorySelect" class="w-full p-2 border rounded-lg">
            <option value="">Select a Category</option>
          </select>
          <button onclick="addTransaction()"
            class="w-full bg-emerald-500 text-white py-2 rounded-lg font-medium hover:bg-emerald-600 transition">Save
            Transaction</button>
        </div>
      </div>

      <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h2 class="text-lg font-semibold mb-4 text-slate-700">Recent Spending</h2>
        <ul id="transactionList" class="divide-y divide-slate-100">
        </ul>
      </div>
    </div>
  </div>

  <script type="module">
    import { checkUser, handleAuth } from './assets/js/auth.js';
    import { addCategory, deleteCategory, loadCategories } from './assets/js/categories.js';
    import { addTransaction } from './assets/js/transactions.js';

    // 1. Attach specific functions to window so HTML 'onclick' attributes work
    window.addCategory = addCategory;
    window.deleteCategory = deleteCategory;
    window.addTransaction = addTransaction;

    // 2. Attach Auth Event Listeners manually (cleaner than onclick in HTML)
    document.getElementById('loginBtn').addEventListener('click', () => handleAuth('login'));
    document.getElementById('signupBtn').addEventListener('click', () => handleAuth('signup'));

    // 3. Start the app
    checkUser();
  </script>
</body>
</html>